{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://tlc4pipe.local/schemas/order.schema.json",
    "title": "Loading Order",
    "description": "Schema for validating pipe loading orders",
    "type": "object",
    "required": [
        "items",
        "pipe_length_m"
    ],
    "properties": {
        "id": {
            "type": "integer",
            "description": "Order ID in database"
        },
        "order_number": {
            "type": "string",
            "description": "Human-readable order reference"
        },
        "pipe_length_m": {
            "type": "number",
            "enum": [
                12.0,
                12.5,
                13.0
            ],
            "default": 12.0,
            "description": "Standard pipe length for this order"
        },
        "items": {
            "type": "array",
            "minItems": 1,
            "items": {
                "$ref": "#/definitions/orderItem"
            },
            "description": "List of pipe types and quantities"
        },
        "truck_config_id": {
            "type": [
                "integer",
                "null"
            ],
            "description": "Optional specific truck configuration"
        },
        "enable_nesting": {
            "type": "boolean",
            "default": true,
            "description": "Enable Matryoshka pipe-in-pipe optimization"
        },
        "max_nesting_levels": {
            "type": "integer",
            "minimum": 1,
            "maximum": 6,
            "default": 4,
            "description": "Maximum telescoping depth"
        },
        "status": {
            "type": "string",
            "enum": [
                "draft",
                "calculated",
                "approved",
                "loaded"
            ],
            "default": "draft"
        },
        "created_at": {
            "type": "string",
            "format": "date-time"
        }
    },
    "definitions": {
        "orderItem": {
            "type": "object",
            "required": [
                "pipe_id",
                "quantity"
            ],
            "properties": {
                "pipe_id": {
                    "type": "integer",
                    "description": "Reference to pipe_catalog.id"
                },
                "quantity": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Number of pipes of this type"
                }
            }
        }
    }
}